---
import SplashLayout from '@/layouts/Splash.astro'

if (Astro.locals.user) return Astro.redirect("/")
---

<SplashLayout title="ASS Stack">
  <div class="flex justify-center flex-col items-center w-[calc(100%-32px)] h-[calc(100%-32px)] fixed rounded-xl bg-white">
    <h1 class="mb-4 font-medium text-lg">Sign In</h1>
    <form method="post" action="/api/login" class="flex flex-col items-center">
			<input name="email" id="email" placeholder="Email" class="border-[1px] border-slate-500 rounded-md p-2" /><br />
			<input type="password" name="password" id="password" placeholder="Password" class="border-[1px] border-slate-500 rounded-md p-2" /><br />
			<button class="bg-slate-300 rounded-md p-2 w-full">Sign In</button>
			<p id="form-error"></p>
		</form>
		<a href="/signup" class="p-4">Create an account</a>
  </div>
</SplashLayout>

<script>
	const errorMessageElement = document.getElementById("form-error")!

	document.forms[0].addEventListener("submit", async (e) => {
		e.preventDefault()
		errorMessageElement.innerText = ""
    const formElement = e.currentTarget as HTMLFormElement

		const response = await fetch(formElement.action, {
			method: formElement.method,
			body: new FormData(formElement)
		})

		if (response.ok) window.location.href = "/"
		else errorMessageElement.innerText = (await response.json()).error
	})
</script>